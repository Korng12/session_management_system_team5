<div th:replace="~{layout/main :: layout(~{::section})}">
<section>

<style>
body {
    background-color: #f8f9fa;
}
.navbar {
    height: 60px;
}
.sidebar {
    position: fixed;
    top: 60px;
    left: 0;
    width: 240px;
    height: calc(100vh - 60px);
    background-color: #212529;
    padding-top: 20px;
}
.sidebar a {
    display: block;
    color: #adb5bd;
    padding: 12px 20px;
    text-decoration: none;
    font-size: 15px;
}
.sidebar a:hover,
.sidebar a.active {
    background-color: #343a40;
    color: #fff;
}
.content {
    margin-left: 240px;
    padding: 80px 30px 30px;
}
.card {
    border-radius: 12px;
}
</style>

<nav class="navbar navbar-dark bg-dark fixed-top">
    <div class="container-fluid">
        <span class="navbar-brand">Conference Admin</span>
        <a href="/logout" class="btn btn-outline-light btn-sm">Logout</a>
    </div>
</nav>

<div th:replace="~{fragments/sidebar :: sidebar}"></div>

<div class="content">
    <h2 class="mb-4">Admin Dashboard</h2>

    <!-- SUMMARY -->
    <div class="row g-4">
        <div class="col-md-3">
            <div class="card shadow-sm text-center">
                <div class="card-body">
                      <i class="bi bi-people fs-2 text-primary"></i>
                                <h6 class="mt-2">Registrations</h6>
                                <h4 th:text="${totalRegistrations}" class="btn btn-primary">0</h4>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card shadow-sm text-center">
                <div class="card-body">
                    <i class="bi bi-calendar-event fs-2 text-success"></i>
                                <h6 class="mt-2">Sessions</h6>
                                <h4 th:text="${totalSessions}" class="btn btn-primary">0</h4>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card shadow-sm text-center">
                <div class="card-body">
                       <i class="bi bi-door-open fs-2 text-warning"></i>
                                <h6 class="mt-2">Rooms</h6>
                                <h4 th:text="${totalRooms}" class="btn btn-primary">0</h4>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card shadow-sm text-center">
                <div class="card-body">
                      <i class="bi bi-building fs-2 text-info"></i>
                                <h6 class="mt-2">Conferences</h6>
                                <h4 th:text="${totalConferences}" class="btn btn-primary">0</h4>
                </div>
            </div>
        </div>
    </div>

    <!-- REGISTRATION CHARTS -->
    <div class="row g-4 mt-4">
        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h5>User Registrations per Conference</h5>
                    <canvas id="barChart"></canvas>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h5>Registration Distribution</h5>
                    <canvas id="doughnutChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- ACTION CARDS -->
    <div class="row g-4 mt-3">
        <div class="col-md-4">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h5>View Registrations</h5>
                    <p class="text-muted">View conference registrations</p>
                    <a href="/admin/view-registeredUsers" class="btn btn-primary">View</a>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h5>Manage Sessions</h5>
                    <p>Create and edit sessions</p>
                    <a href="/admin/manage-sessions" class="btn btn-success">Manage</a>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h5>Manage Rooms</h5>
                    <p>Manage available rooms</p>
                    <a href="/admin/manage-rooms" class="btn btn-warning">Manage</a>
                </div>
            </div>
        </div>
    </div>

    <!-- HIDDEN DATA -->
    <div class="d-none">
        <span class="conf-title"
              th:each="r : ${registrations}"
              th:text="${r.conference.title}">
        </span>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function () {

    const counts = {};

    document.querySelectorAll('.conf-title').forEach(el => {
        const title = el.textContent.trim();
        counts[title] = (counts[title] || 0) + 1;
    });

    if (Object.keys(counts).length === 0) return;

    const labels = Object.keys(counts);
    const values = Object.values(counts);

    new Chart(document.getElementById('barChart'), {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                data: values,
                backgroundColor: '#0d6efd'
            }]
        },
        options: {
            responsive: true,
            plugins: { legend: { display: false } },
            scales: { y: { beginAtZero: true } }
        }
    });

    new Chart(document.getElementById('doughnutChart'), {
        type: 'doughnut',
        data: {
            labels: labels,
            datasets: [{ data: values }]
        }
    });

});
</script>

</section>
</div>
